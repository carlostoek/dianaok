> Eres un desarrollador experto en bots de Telegram, backend asÃ­ncrono en Python (con aiogram y SQLAlchemy), sistemas de gamificaciÃ³n, diseÃ±o de narrativa interactiva y administraciÃ³n de contenido. Quiero que desarrolles dianaok, un bot de Telegram que combina:

canales privados,

narrativa emocional con decisiones,

gamificaciÃ³n (puntos, badges, niveles),

reacciones de usuarios,

sistema de tienda y subastas,

roles y progresiÃ³n,

panel administrativo completo.


Todo el sistema se organiza con backend en Python + SQLite para desarrollo y PostgreSQL para producciÃ³n. El frontend serÃ¡ Telegram, usando botones inline, estados FSM, mensajes enriquecidos y multimedia almacenado directamente en Telegram.




---

ğŸ¯ Objetivo General:

Crear un sistema completo que gestione la experiencia de usuario dentro de dos canales de Telegram:

Los Kinkys (gratuito): acceso limitado a narrativa y participaciÃ³n bÃ¡sica.

El DivÃ¡n (VIP): acceso completo a narrativa expandida, contenido especial y funciones avanzadas.



---

ğŸ§  Arquitectura del Proyecto

Crea una estructura limpia y escalable con carpetas como:

/
â”œâ”€â”€ main.py
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ setup.py
â”‚   â”œâ”€â”€ models.py
â”‚   â””â”€â”€ queries.py
â”œâ”€â”€ handlers/
â”‚   â”œâ”€â”€ start.py
â”‚   â”œâ”€â”€ narrative.py
â”‚   â”œâ”€â”€ reactions.py
â”‚   â”œâ”€â”€ gamification.py
â”‚   â”œâ”€â”€ store.py
â”‚   â””â”€â”€ admin_panel.py
â”œâ”€â”€ logic/
â”‚   â”œâ”€â”€ narrative_engine.py
â”‚   â”œâ”€â”€ gamification.py
â”‚   â”œâ”€â”€ store_logic.py
â”‚   â””â”€â”€ access_control.py
â”œâ”€â”€ keyboards/
â”‚   â”œâ”€â”€ inline.py
â”‚   â””â”€â”€ reply.py
â”œâ”€â”€ states/
â”‚   â””â”€â”€ user_states.py
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ config.py
â”‚   â””â”€â”€ helpers.py
â””â”€â”€ data/
    â””â”€â”€ story_fragments.json


---

ğŸ‘¤ Funcionalidades del Usuario

1. Sistema de Narrativa Interactiva:

Fragmentos de historia con decisiones tipo "elige tu aventura".

Acceso condicionado por nivel, puntos o suscripciÃ³n VIP.

Algunas decisiones desbloquean partes ocultas.



2. GamificaciÃ³n:

Ganas puntos por reaccionar, leer, explorar.

Desbloqueas badges, niveles, y acceso especial.

IntegraciÃ³n de economÃ­a (tokens internos).



3. Reacciones:

Se permiten solo reacciones a publicaciones.

Las reacciones suman puntos automÃ¡ticamente.

Registro en base de datos de quÃ© reaccionÃ³ cada usuario.



4. Roles:

Usuario bÃ¡sico, VIP, staff, administrador.

Los roles definen el acceso y visibilidad de ciertas funciones.





---

ğŸ›ï¸ Tienda y Subastas

Compra objetos, entradas a escenas secretas o privilegios narrativos.

Subastas especiales donde los VIPs pujan con tokens.

Todo mediante inline buttons.



---

âš™ï¸ Panel Administrativo

Webhook para staff y admins:

Crear nuevos fragmentos narrativos.

Activar promos y eventos temporales.

Ver estadÃ­sticas de usuarios, puntos, reacciones, progreso.


Telegram Admin Tools:

EnvÃ­o masivo de mensajes.

Crear encuestas narrativas.

Controlar el acceso a nuevas temporadas.




---

ğŸ§© Base de Datos (ORM SQLAlchemy)

Modelos necesarios:

User(id, username, role, points, level, is_vip)

LorePiece(id, title, content, options, requirements)

UserLorePiece(user_id, lore_id, decision)

Reaction(user_id, message_id, emoji)

Badge(id, name, description, condition)

UserBadge(user_id, badge_id)

Item(id, name, type, price, description)

Inventory(user_id, item_id, quantity)

Auction(id, item_id, start_time, bids)

Bid(user_id, auction_id, amount)

AdminActionLog(...)



---

ğŸ¤– Telegram Integration

Usa aiogram 3.x con FSMContext para flujo por estados.

Carga de fragmentos desde story_fragments.json o base de datos.

Usa mensajes enriquecidos con emojis, markdown, multimedia.

Usa botones inline para decisiones, tienda, navegaciÃ³n.

Aplica callback_data estructurado para acciones complejas.



---

ğŸ§ª Desarrollo / ProducciÃ³n

Base de datos: SQLite local / PostgreSQL en producciÃ³n.

Usa .env y sistema de configuraciÃ³n dinÃ¡mico.

MÃ³dulo de logging detallado.

Incluye README.md con instrucciones de instalaciÃ³n y despliegue.



---

ğŸ’¡ Extra: Tono de Diana

Diana es un personaje emocional, enigmÃ¡tico, inteligente.

Usa frases introspectivas, con referencias poÃ©ticas y filosÃ³ficas.
Su tono cambia segÃºn el tipo de usuario (curioso, lÃºdico, melancÃ³lico).

Genera un archivo diana_voicebank.py con frases listas para su uso segÃºn contexto.



---

ğŸ“¦ Salida esperada

Genera todos los archivos de cÃ³digo necesarios para que el bot sea funcional, ejecutable y extensible. Implementa pruebas mÃ­nimas, documentaciÃ³n bÃ¡sica y separa lÃ³gica de presentaciÃ³n.


---

ğŸ› ï¸ MÃ³dulo de AdministraciÃ³n de Canales â€“ DianaBot

Este mÃ³dulo transforma a DianaBot en un sistema inteligente de gestiÃ³n de canales privados con lÃ³gica de acceso, roles jerÃ¡rquicos, estadÃ­sticas y control total del entorno narrativo y gamificado.
Va mÃ¡s allÃ¡ de un simple filtro: es un centro de operaciones narrativo, un sistema de vigilancia emocional y un motor de control dinÃ¡mico de experiencias.


---

ğŸ­ Â¿QuiÃ©nes estÃ¡n involucrados?

ğŸ•´ï¸ Lucien â€“ El Mayordomo
Administrador silencioso de los canales.
Se encarga de dar la bienvenida, aplicar sanciones suaves, detectar irregularidades y activar eventos narrativos.
Su lenguaje es sofisticado, ligeramente irÃ³nico, pero siempre firme.

ğŸ‘‘ Staff y Moderadores
Usuarios con permisos especiales.
Pueden usar comandos para enviar mensajes globales, aprobar contenido y revisar estadÃ­sticas.
Son la conexiÃ³n humana que complementa la automatizaciÃ³n.

ğŸ‘¤ El Usuario
Espectador-activo del canal.
InteractÃºa principalmente mediante reacciones.
Sus movimientos y respuestas son monitoreados para ajustar su experiencia.


---

ğŸ§  Â¿CÃ³mo funciona este sistema?

ğŸ”¹ 1. Control de Acceso Avanzado

Los canales estÃ¡n segmentados en:

PÃºblico (Los Kinkys)

VIP (El DivÃ¡n)


El acceso VIP se valida mediante:

Base de datos interna.

SubscripciÃ³n confirmada.

Roles especÃ­ficos.


El sistema puede expulsar automÃ¡ticamente usuarios sin acceso vÃ¡lido o que no hayan completado pasos previos.



---

ğŸ”¹ 2. Reacciones como Entrada

Las Ãºnicas acciones permitidas por usuarios son reacciones.

Cada reacciÃ³n:

Se registra en la base de datos.

Puede otorgar puntos, desbloquear fragmentos o activar respuestas ocultas.


Reaccionar incorrectamente (a ciertos emojis) puede tener consecuencias narrativas o lÃºdicas.



---

ğŸ”¹ 3. Roles JerÃ¡rquicos y Personalizados

El sistema gestiona roles como:

curioso, cazador, devoto, VIP, staff, admin.


Cada rol tiene:

Permisos de acceso.

Diferente visualizaciÃ³n del contenido.

Experiencia narrativa Ãºnica (algunos fragmentos aparecen sÃ³lo a ciertos roles).




---

ğŸ”¹ 4. EstadÃ­sticas y MonitorizaciÃ³n

El sistema registra:

CuÃ¡ntas veces un usuario reaccionÃ³.

QuÃ© emojis usa mÃ¡s.

Tiempo promedio entre reacciones.

QuÃ© fragmentos ha desbloqueado.


Staff puede ver:

Ranking por actividad.

Jugadores dormidos o ausentes.

AnÃ¡lisis emocional por estilo de respuesta.




---

ğŸ”¹ 5. Mensajes Inteligentes Automatizados

El bot puede enviar:

Bienvenidas personalizadas.

Advertencias narrativas (â€œLucien te observaâ€¦â€).

Promociones segmentadas por comportamiento.


Los mensajes son emocionales, nunca frÃ­os:

"Has estado muy callado Ãºltimamente. Diana te extraÃ±a..."

"Algunos secretos sÃ³lo se revelan cuando alguien se atreve a mirar mÃ¡s de una vez..."




---

ğŸ”¹ 6. Herramientas Administrativas para el Staff

Comandos exclusivos por botÃ³n inline o respuesta a mensajes:

/stats @usuario

/promote @usuario vip

/revoke acceso @usuario

/mensaje_global 'texto'


Posibilidad de crear eventos como:

Reactivaciones de jugadores dormidos.

Promos de besitos por reacciÃ³n masiva.

Minijuegos internos (misiones ocultas por emoji).




---

ğŸ”¹ 7. GestiÃ³n de Contenido por Canal

Cada canal tiene su propio calendario narrativo.

Se pueden configurar:

Horarios de publicaciÃ³n.

Fragmentos programados.

CombinaciÃ³n entre contenido pÃºblico y VIP.

Crossposting selectivo con pistas o metajuego.




---

ğŸ”¹ 8. Panel de Control (futuro web o Telegram embebido)

VisualizaciÃ³n de:

Usuarios activos vs. pasivos.

Curvas de reacciÃ³n por dÃ­a.

Fragmentos con mÃ¡s engagement.

Logs de decisiones narrativas.


Control directo sobre:

Activar/desactivar niveles narrativos.

Iniciar eventos automÃ¡ticos por tiempo o reacciÃ³n.
